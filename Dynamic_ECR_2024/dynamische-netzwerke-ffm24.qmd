---
title: "Dynamic Network Analysis"
subtitle: "An Introduction"
author: 
  - name: "Björn Siepe"
    orcid: 0000-0002-9558-4648
    email: bjoern.siepe@uni-marburg.de
    affiliations: 
      - name: "Psychological Methods Lab, University of Marburg"
        city: "Slides at bsiepe.github.io/talks"
email: bjoern.siepe@uni-marburg.de
date: "10-23-2024"
from: markdown+emoji
format: 
  clean-revealjs:
    incremental: true
    embed-resources: true
    slide-number: true
    auto-stretch: false
    echo: true
    progress: true
    code-block-bg: true
    code-block-border-left: "#31BAE9"
    self-contained-matrh: true
bibliography: bibliography.bib
---

## Materials and Goals

::::::: columns
:::: {.column width="50%"}
::: fragment
Slides at bsiepe.github.io/workshops ![](figures/qr_workshop_hp.png)
:::
::::

:::: {.column width="50%"}
::: fragment
1.  Understand advantages and structure of time series data and dynamic networks
2.  Interpret dynamic networks
3.  Get to know core assumptions, evidence, and limitations
4.  Learn about new developments and future research topics
:::
::::
:::::::

::: notes
-   Structure:

1.  What are dynamic networks and why do we need them
2.  Deeper look at typical models, interpretation
3.  Issues and potential solutions
:::

## What we don't cover (in detail)

1.  Cross-sectional networks
2.  Planning of longitudinal studies
3.  Estimation of networks in R (but see additional materials)
4.  Clinical theory
5.  Data and preprocessing (very important)
6.  Panel Data

## Hype Cycle

```{r, out.width = '700px', out.height= "520px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/hype_cycle.svg'))
```

::: aside
[Jeremykemp, Wikimedia](https://commons.wikimedia.org/wiki/File:Gartner_Hype_Cycle.svg)
:::

::: notes
-   keine Magie, sehr ähnlich zu Regression
-   thinking tools für andere Konzepte
-   anschlussfähig für weitere Wissenschaften
-   andere Innovationen, wie EGA
:::

<!-- ## Why Longitudinal Data? -->

<!-- ```{r, out.width = '900px', out.height= "520px", echo = FALSE} -->
<!-- knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/typingspeed.svg')) -->
<!-- ``` -->

<!-- ::: aside -->
<!-- Oriented at a figure by Ellen Hamaker -->
<!-- ::: -->

::: notes
Simpson's Paradox
:::

# Dynamic Networks {background-color="#40666e"}

## General principles



::::::: columns
:::: {.column width="50%"}
::: fragment
-   Dynamic associations within individuals
-   Across time points and at the same time frames
-   $n = 1$ (idiographic) and $n > 1$
-   Commonly some form of vector autoregressive (VAR) model
-   Often some sparsity
:::
::::

:::: {.column width="50%"}
::: fragment
```{r, out.width = '600px', out.height= "400px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/example_temporal.svg'))
```
:::
::::
:::::::

::: notes
ask people before what they think a dynamic network even is?
:::

## Time Series Data

```{r, out.width = '900px', out.height= "500px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/data-cube.jpg'))
```

::: aside
@beltzBridgingNomotheticIdiographic2016
:::

## Experience Sampling

::::: columns
::: column
```{r, out.width = '400px', out.height= "400px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/smartwatch-unsplash.jpg'))
```
:::

::: column
```{r, out.width = '400px', out.height= "400px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/smartphone-unsplash.jpg'))
```
:::
:::::

::: aside
Sabina Ciesielska (Unsplash), Jonas Leupe (Unsplash)
:::

::: notes
-   Ecological Momentary Assessment
-   Intensive Longitudinal Data
:::

## Autoregressive

::: fragment
![](figures/sadness_ar.png)
:::

::: aside
Next slides inspired by Julian Burger ([Link](https://osf.io/djm26))
:::

::: notes
-   AR auch Inertia
:::

## Autoregressive

![](figures/ar1_time_series.gif)




## Cross-Lagged

::: fragment
![](figures/cross_lagged_viz.png){width=700 height=500 fig-align=center}

:::

::: notes
-   gleicher Zeitpunkt: negativer Zusammenhang (während Sport bin ich weniger müde)
-   über Zeitpunkte: positiv in eine Richtung
:::

## Estimation of idiographic networks

:::: fragment
::: callout-note
## Model Equations





For our example: 

\begin{aligned}
\color{darkred}{Sad_{t}} = \color{blue}{\beta_{11}}*\color{darkred}{Sad_{t-1}} + \color{blue}{\beta_{12}}*\color{darkred}{Rumination_{t-1}} + \color{orange}{\epsilon_{t,1}} \\
\color{darkred}{Rumination_{t}} = \color{blue}{\beta_{21}}*\color{darkred}{Rumination_{t-1}} + \color{blue}{\beta_{22}}*\color{darkred}{Sad_{t-1}} + \color{orange}{\epsilon_{t,2}}
\end{aligned}


More generally: $$
\color{darkred}{Y_{t}} = \color{blue}{\boldsymbol{B}} \color{darkred}{Y_{t-1}} + \color{orange}{\Sigma}
$$
:::
::::

-   [Red:]{style="color:darkred;"} Data at current ($t$) and previous ($t-1$) time point
-   [Blue:]{style="color:blue;"} Coefficients for autoregressive and cross-lagged effects
    -   used for temporal effects
-   [Orange:]{style="color:orange;"} Residuals/Innovations (in $\Sigma$ )
    -   used for contemporaneous effects

## Formalization

We define: $$G = (V,E)$$ as an undirected graph consisting of nodes $V = \{1, \ldots, p\}$ and edges $E \subseteq V \times V$.

We associate a random variable $X_v$ to each node $v \in V$. $X_v$ takes values in space $\mathscr{X}_v$.

Theorem 1:

## Maths Break {.smaller}

![](figures/maths-gif.gif)

::: aside
https://media.giphy.com/media/lHfxDepSGlzom6f65K/giphy.gif
:::

## Intermediate Summary

-   Networks are everywhere
-   Almost any multivariate model can be a network
-   A lot of cross-sectional studies with limited informativeness
-   Longitudinal data allows for new insights
-   Effects across time points and variables

# Interpreting dynamic networks {background-color="#40666e"}

## Temporal Network

::::: columns
::: column
-   Effect of variables on themselves and on others over time
-   Directed effects
-   Mostly: lag 1 
-   "Granger causality"
:::

::: column
::: fragment
![](figures/temporal_net.png){fig-align="center" height=550}
:::
:::
::::



## "Contemporaneous" Network

:::: columns
::: column
-   Partial correlation of residuals (innovations)
-   undirected effects not captured by temporal network
-   For example: effects faster than sampling frequency
-   Example: $$ 
    Stress \rightarrow  Expect\ Panic \rightarrow Fear 
    $$
:::

::: column
::: fragment
![](figures/contemp_viz.png){fig-align="center" height=550}
:::
:::

::::




::: aside
Example from @epskampPersonalizedNetworkModeling2018
:::

::: notes
-   beziehen zeitliche Info mit ein
-   nicht gleich zu normaler Korrelation
-   oft sehr "voll" im Vergleich zu temporalem
:::

## Putting Things Together

![](figures/full_net_viz.png){fig-align="center" height=600 width=900}

::: notes
do you now understand why you want sparsity?
:::


## Example: @epskampPersonalizedNetworkModeling2018

::: fragment
```{r, out.width = '1000px', out.height= "500px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/example-gvar.png'))
```
:::



## $n >1$ Networks

-   Often used: multilevel modeling
-   Popular alternative: GIMME
-   Advantages:
    -   pool information from individuals
    -   more power
    -   Consideration of heterogeneity
    -   fewer time points necessary
-   `mlVAR` [@epskampPersonalizedNetworkModeling2018]
-   `GIMME` [@beltzBridgingNomotheticIdiographic2016]
-   `DSEM` [@hamakerFrontiersModelingIntensive2018]

::: aside
Simple overview in @jordanCurrentStatusTemporal2020
:::

::: notes
-   GIMME: Gruppe, Subgruppe, Individuum
-   DSEM: Sehr flexibel
-   mlVAR: Heterogenität visualisierbar
:::

## mlVAR and GIMME

:::: columns

::: column
**mlVAR**

-   Borrow [quantitative]{.alert} information
-   Individual network parameters come from a shared probability distribution
-   Parameters are "pulled together"
-   "Between-person" network

:::

::: column
**GIMME**

-   Borrow [qualitative]{.alert} information
-   Individual networks, but partially common structure
-   Group, subgroup, individual networks
-   Heuristic algorithm

:::

::::


## Multilevel Example

```{r, out.width = '1100px', out.height= "520px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/mlVAR-example.png'))
```

::: aside
@epskampPersonalizedNetworkModeling2018
:::

::: notes
-   Between-Subject: Mittelwertszusammenhänge
-   Konkreter: Person-Means als Lvl-2 Prädiktoren
-   GGM auf Mittelwerte
-   kann auch indikativ für Kausalität sein (s. Tippbeispiel)
-   möglich: Plotting von Heterogenität
:::

## GIMME Example

TODO STILL THINK ABOUT THIS

## Interpretation: Time Intervals

-   Equal time intervals between measurements
    -   Night effect [@berkhoutLetSleepingDogs2024]
    -   Alternative: Continuous time [@ryanTimeInterveneContinuoustime2022]
-   Correct time intervals for constructs to be measured
    -   Stress vs. depression


::: notes
-   Was ist mit Nacht?
-   Normalverteilung vs. Skew
:::

## Interpretation: Change over Time

:::: columns
::: column
![](figures/non_stationarity.png){fig-align="center" height=550 width=550}
:::

::: column
-   Stationarity assumption: Means, variances, covariances are constant over time
-   Realistic?
:::

::::


::: aside
@ryanNonstationarityTimeseriesAnalysis2023
:::


::: notes
-   Trend entfernen bedeutet Information entfernen
:::


## Interpretation: Other Stuff
-   Causality?
-   Variable selection?
-   Stability of idiographic network estimates
-   Missing data
-   Distributional assumptions -> TODO floor effect
-   Power
    -   Absence of evidence $\neq$ Evidence for absence

<!-- ## Implementations -->

<!-- ::: fragment -->
<!-- Many packages available for dynamic network/time series analysis: -->
<!-- ::: -->

<!-- ::: fragment -->
<!-- ```{r, eval = FALSE} -->
<!-- #| code-line-numbers: "|1|2|3|4|5|6|7"  -->
<!-- library(graphicalVAR)  # Idiographic networks with LASSO -->
<!-- library(tsnet)         # Idiograhpic Bayesian networks -->
<!-- library(mlVAR)         # Multilevel networks -->
<!-- library(GIMME)         # GIMME -->
<!-- library(mgm)           # Mixed graphical models and time-varying models -->
<!-- library(psychonetrics) # General framework for network analysis -->
<!-- library(dynr)          # Dynamical systems, state-space -->
<!-- library(mlts)          # DSEM-like latent time series models -->
<!-- ``` -->
<!-- ::: -->


## Optional: Practical Exercise

:::: columns
::: column
If time permits: 
- Open file `dynamic_network_exercise.R`
- Work alone or in groups of 2-3
:::

::: column
TODO insert QR code for google colab
:::
::::

# Evidence and Pitfalls

## Topics to be covered

-   Estimation Requirements
-   Clinical Practice
-   Density/Centrality
-   Prediction

::: notes
-   Ultimately: What do we do with these networks?
:::

## Understanding Heterogeneity

![](figures/false_heterogeneity.gif){width=550 height=550 fig-align="center"}

::: aside
@hoekstraHeterogeneityIndividualNetwork2022
:::

::: notes
-   Auf Stichprobengröße eingehen
-   Mindestens 20 Personen für Multilevel
:::

## Problem: Estimation Instability

::::: columns
::: column
::: fragment
```{r, eval = FALSE} 
#| code-line-numbers: "|1-6|7-9|" 
# Simulate 20 identical twins
for(i in 1:20){
  l_data[[i]] <- graphicalVAR::graphicalVARsim(
    nTime = 70,
    beta = person_1$beta,
    kappa = person_1$kappa)
# Fit network models
  l_fits[[i]] <- graphicalVAR(l_data[[i]])
}
```
:::


:::

::: column

::: fragment
![](figures/giphy_hehe.gif)
:::

:::
:::::


## Feasibility of Idiographic Networks

> The robustness of network results now firmly ranks as one of the field’s top priorities. [@marsmanGuestEditorsIntroduction2022]

-   often only have vague rules of thumb
-   Number of time points?
    -   at 75 and 100: poor sensitivity
-   Number of variables?
    -   always think about number of paths to estimate!

::: aside
@mansuetoInvestigatingFeasibilityIdiographic2023, Siepe et al. [-@siepeBayesianEstimationComparison2024]
:::

## Solutions for Estimation Instability

-   Tests to compare idiographic networks [@hoekstraTestingSimilarityLongitudinal2024; @siepeBayesianEstimationComparison2024]

-   With $n > 20$ (or so): Go multilevel/GIMME

    -   Multilevel often outperforms $n = 1$, even if true model is idiographic [@lafitSystematicStudyFactors2021]

-   Sample size planning for $n = 1$ [@revolNewSamplesizePlanning2024]

## Solutions for Estimation Instability

![](figures/shiny_app_revol.png){width=650 height=550 fig-align="center"}

<!-- ::: aside -->
<!-- https://gitlab.kuleuven.be/ppw-okpiv/researchers/u0148925/shinyapp-paa_var_n1 -->
<!-- ::: -->

## Evidence in Clinical Practice {.smaller}

-   @frumkinFeasibilityUtilityIdiographic2021
    -   Few case studies
    -   Patients more convinced than therapists
-   @levinsonPersonalizingEatingDisorder2023
    -   n = 79, eating disorders
    -   Module selection based on networks
-   @hallUsingPersonalizedAssessment2022a
    -   Individual case study on TheraNET
    -   Good example of detailed, network-based feedback
    -   Apparently RCT planned
-   No clear evidence
-   Many different possibilities for use [@schumacherMethodologicalStatisticalPractices2024]

::: notes
Noch mehr zu EMA-Feedback
:::

## Recent developments

-   Cooperation between therapist/patient and data
-   Changes over time
-   Prediction of therapy outcomes

## PECAN

![](figures/pecan.jpeg){width=650 height=550 fig-align="center"}

::: aside
@klintwallPerceivedCausalProblem2021
:::

## PREMISE

![](figures/premise.png)

::: aside
@burgerClinicalPREMISEPersonalized2022, @burgerNovelApproachConstructing2024, @siepeBayesianEstimationComparison2024
:::

## Time varying networks

```{r, out.width = '700px', out.height= "520px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/tvvar.gif'))
```

::: aside
Siepe et al. [-@siepeTimeVaryingNetworkModels2024], @haslbeckTutorialEstimatingTimevarying2021, @scholtenWhatTimevaryingNetwork2023
:::

## Centrality/Density

![](figures/connectivity_networks.png){width=550 height=550 fig-align="center"}


::: aside
@hoekstraMappingDynamicsIdiographic2024
:::

## Prediction

-   what the economists do
-   Revol et al. things
-   work by Yong
-   Lafit shows that networks often do not predict well

## Prediction

```{r, out.width = '700px', out.height= "500px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/lutz-et-al.png'))
```

::: aside
@lutzUsingNetworkAnalysis2018
:::

::: notes
-   kleine Studie
:::

## Prediction

::: fragment
-   @johalRelatingNetworkinstantiatedConstructs2024:
    -   Using network-derived metrics to predict an outcome
    -   Network features did not work very well
-   @schumacherPredictingOutcomePsychotherapy2024
    -   Using pairwise symptom associations and centrality to predict an outcome
:::

:::: fragment
::: callout-tip
Start simple instead of complicated [@bringmannFutureDynamicNetworks2024]

It is hard to beat the mean [@dejonckheereComplexAffectDynamics2019]
:::
::::

## Which analyses?

::: fragment
```{r, out.width = '900px', out.height= "450px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/bastiaansen.png'))
```
:::

::: aside
@bastiaansenTimeGetPersonal2020
:::

::: notes
-   meistens VAR
:::

## Analytic uncertainty: Go multiverse

::: fragment
```{r, out.width = '700px', out.height= "520px", echo = FALSE}
knitr::include_graphics(here::here('Dynamic_ECR_2024/figures/multiverse_plot.pdf'))
```
:::


::: aside
@siepeMultiverseAnalysisDynamic2023
:::

# Summary

## Outlook


![](figures/bringmann_thesis.png)

<!-- -   What is the future of networks in clinical settings? -->
<!-- -   “More than a pretty picture?” -->
<!-- -   Stability over time -->
<!-- -   Theory -->
<!-- -   Linking data-driven models and theories [@kaiserNeedTheorybuildingRobust2023, @haslbeckModelingPsychopathologyData20211104] -->

## Main Takeaways

::: fragment
1.  Networks are conceptually attractive
2.  Longitudinal data give us new information ... but also new problems
3.  High diversity in network approaches
4.  Evidence of utility is still scarce
5.  Embrace simplicity and uncertainty
:::

:::: fragment
::: {style="font-size: 150%;"}
**Questions or Comments?** :bulb:
:::
::::

## Get in Touch

::::: columns
::: {.column width="40%"}
{{< fa house >}} [Feel](https://bjoernsiepe.netlify.app/)

{{< fa brands twitter >}} [free](https://twitter.com/b_siepe)

{{< fa brands mastodon >}} [to](https://fediscience.org/@bsiepe)

{{< fa at >}} [contact](bjoern.siepe@uni-marburg.de)

{{< fa brands github >}} [me](https://github.com/bsiepe)

bjoern.siepe\@uni-marburg.de
:::

::: {.column width="60%"}
![](figures/qr_workshop_hp.png)
:::
:::::

# Resources

## Materials

[PNAWS 2020](https://osf.io/hcd8u/) - freely accessible. Partly served as inspiration for this workshop, especially the slides by Julian Burger.

[Psych Networks Blog](https://psych-networks.com/) - no longer active, but interesting backlog

[Workshops by Noémi Schuurman](https://www.nkschuurman.com/workshops.html) - multiple materials for multilevel models in R and MPlus

[Applied Workshop by Me](https://github.com/bsiepe/dynamical-networks-workshop/tree/main/Anwendungs_Workshop_FFM_23) - slides including more code examples etc.

## Figures {.smaller}

Jeremykemp at English Wikipedia (https://commons.wikimedia.org/wiki/File:Gartner_Hype_Cycle.svg), „Gartner Hype Cycle", https://creativecommons.org/licenses/by-sa/3.0/legalcode

Foto von <a href="https://unsplash.com/@sabina_ciesielska?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Sabina</a> auf <a href="https://unsplash.com/de/fotos/0zAHoJ1gnGg?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>

Foto von <a href="https://unsplash.com/@jonasleupe?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Jonas Leupe</a> auf <a href="https://unsplash.com/de/fotos/wK-elt11pF0?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>

<a href="https://www.flaticon.com/free-icons/rumination" title="rumination icons">Rumination icons created by Freepik - Flaticon</a>

Shiny App Screenshot from https://gitlab.kuleuven.be/ppw-okpiv/researchers/u0148925/shinyapp-paa_var_n1 

"Hehe GIF" from [giphy](https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExNDN4d3BxN3F2ZnVrYjFzNnV3b2Q4bnEwc2JzdmlzcG8zYjF0NHJ2eiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/B0vFTrb0ZGDf2/giphy.gif)

## References {.smaller .scrollable}

::: {#refs}
:::
